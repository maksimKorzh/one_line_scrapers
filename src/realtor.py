# Run scrapy shell like this: scrapy shell --set="COOKIES_ENABLED=False"
# to pass cookies along with headers.
#
# You might need to update your cookie string within the line below to make it work properly 

# Real estate properties scraper (realtor.com)
import scrapy, json, csv; open('realtor.csv', 'w').write('title,address,price,bedrooms,bathrooms,area,area_lot\n'); [(fetch(scrapy.Request(url='https://www.realtor.com/realestateandhomes-search/Los-Angeles_CA/pg-' + str(page), headers={'cookie': 'split_tcv=164; __vst=2be88d8f-48fe-43f6-817a-f26ba0575d1b; __ssn=d9906063-e499-485f-b224-332a817542a2; __ssnstarttime=1592121706; __split=54; ab.storage.userId.7cc9d032-9d6d-44cf-a8f5-d276489af322=%7B%22g%22%3A%22visitor_2be88d8f-48fe-43f6-817a-f26ba0575d1b%22%2C%22c%22%3A1592121710105%2C%22l%22%3A1592121710105%7D; ab.storage.deviceId.7cc9d032-9d6d-44cf-a8f5-d276489af322=%7B%22g%22%3A%2215e74c73-fecb-6d75-0939-57c4907022cf%22%2C%22c%22%3A1592121710113%2C%22l%22%3A1592121710113%7D; AMCVS_8853394255142B6A0A4C98A4%40AdobeOrg=1; __gads=ID=ec698711c2eac298:T=1592121710:S=ALNI_Mb7mluIKuM5Su7SKes2KM5j7Sfnlg; s_ecid=MCMID%7C60803714203788731302307719052292398363; ajs_anonymous_id=%223488df9c-390d-409d-a0ab-05043be67859%22; _tac=false~self|not-available; _ta=us~1~89df68bc35032d48c293adce8574aa42; G_ENABLED_IDPS=google; _fbp=fb.1.1592121714185.1423036765; _ga=GA1.2.2138886178.1592121710; _ncg_g_id_=86e6f3af-a4d6-4990-be4e-39089703a114; __qca=P0-824223133-1592121715195; user_canceled_one_tap=true; user_activity=return; _gid=GA1.2.2041300531.1592382358; _ncg_id_=17093c168eb-4f6fcc04-f4b2-4b9f-a21a-51bda5112d26; threshold_value=100; automation=false; clstr=v; clstr_tcv=98; __edwssnstarttime=1592382887; bcc=false; bcvariation=SRPBCRR%3Av1%3Adesktop; last_viewed_property=%2Frealestateandhomes-detail%2F24425-Woolsey-Canyon-Rd-Spc-128_Canoga-Park_CA_91304_M95870-99917; _rdc-next_session=R0ZyMnZrSU9sZmVCKzgxWldJaXU3SkEwaytCTm9NTXZIaExYZ3FYSGxaekxHMG1pUHBQYSt4dUtWdTNlWFc3a3JpN0d3Zk44dTdKNzVBdW9nZXVIL2tTVExMTXdPUlo4ZVFULy9sNFpHQzAzOUM2Qit6cVdUSzFSRFdNTEowd2tQdXprMytUZ0kvREgwQnhtQXBjMkk4RmQ0QlhXL2ljdlBSNmZ2MGlNczI3ZEl5OGhkV2k2dURQcTNWL21McUZwTmNlUHlhY3ZqWHBEekxJNC81L0F1N3BqNkwyTERMZmdETXFzaDZzVzlPUlZBZ1ZKYVF4L2lqTWJwdHRGQmlmTitNRXZ5YXdQaDkyTnBHZzRnbERJYTZiWTc2YVpxVElhRCs3R2Z0dGJYNXhicGJja1BHVWFSd2RvT0dacFo3VDhkSEFhMExMRE56bFUxSXRLUmNPaFFkZnkyV21QeVRLTUhsbkFZUXhwTlhVWDVKOFFPby9UY0pmMmdQUVBONFAyWUJXUDNrdzBaQmpqTVBwd041TU1nTFgyb08yZmpwUktqSTFORjVnaTRRTzN0VnI1QUQ4bm9yejJsNzdLUW5MTExHNTltNHZtZFg1TmY2bTk2RWJOVHNYclRzUHkyNW9pdmhhV0tpWElLRlBTcm1Pa2YyU0EwU1Y0YzFMMU9kS29aWHk4NW5WSm1JNnJEb0lidm5Odkt5b2sxbElDdDdKRGFaMmdXTSs1OCtjPS0tM1h6ekMzQnhPNmlMajBFQnc5VzR5UT09--63ab465f5ee76a8b6770a3075cfd9ba0fa1eea3b; split=v; AMCV_8853394255142B6A0A4C98A4%40AdobeOrg=-1712354808%7CMCIDTS%7C18431%7CMCMID%7C60803714203788731302307719052292398363%7CMCAAMLH-1593002015%7C6%7CMCAAMB-1593002015%7CRKhpRz8krg2tLO6pguXWp5olkAcUniQYPHaMWWgdJ3xzPWQmdj0y%7CMCOPTOUT-1592404415s%7CNONE%7CMCAID%7CNONE%7CvVersion%7C4.3.0; _tas=r9c9qp6fkpe; _ncg_sp_ses.cc72=*; last_ran=-1; srchID=c87cc2f2e6f744a89a191eef3aa0668d; criteria=pg%3D1%26locSlug%3DLos-Angeles_CA%26sprefix%3D%252Frealestateandhomes-search%26city%3DLos%2520Angeles%26state_code%3DCA%26state_id%3DCA%26area_type%3Dcity%26search_type%3Dcity%26lat%3D34.0193936%26long%3D-118.4108248%26county_fips%3D06037%26county_fips_multi%3D06037%26loc%3DLos%2520Angeles%252C%2520CA; last_ran_threshold=1592397257361; ab.storage.sessionId.7cc9d032-9d6d-44cf-a8f5-d276489af322=%7B%22g%22%3A%2247c16e3a-cd48-8e12-6109-91d7cfbe00c7%22%2C%22e%22%3A1592399059738%2C%22c%22%3A1592397221668%2C%22l%22%3A1592397259738%7D; reese84=3:1uFqAHDprAgmqeahutkzfg==:WCfoRMB8diC/QEsYCH7l8BzAkq7/lV58lHb8zGkv8dU8jOa65wskoKh55LVESQAkhnU0rAA83hEVfDASkS+ntB6G+P+1fCMvPG7QJKxDwOl98SlNNqqABY2k3Hp+8HlHRIkExaL+QBCrB1rN5RmjdQiggSZnrYS8LKbBfDRyYu067jH0b5ZWWDp5E1tT00vK2j1ccp1xJrZvrnY25CVcWGXcd/pw7gajFAos7UQpPgH2CQXi4lTvDiHU2/2QuO1xStT5uaD8hVqfhkkc5EacoGYAWqLC2uZtJpTvrHjOQDPoZ85rGDkkFUoCOBa/8j7dwluUxti2akYhHYsOHqkvvxEAXxQ48v+1HpGBem+RKXXxqtxX41BwsWjIL1dQlmTQy2TJMj6YrnK7lKLoWu8VWsida2zhb1yTMH40s+CfAMueIhW/bpk+d1TBw1J3XWJBj/I5RlUQFWRv5bSo+8yecfmxHxbMOikAzHjY/Mz3LcU=:4KO6HZCJac3ycmvGBu1PUlwJzbBTfhbOxThUXgkfHRc=; adcloud={%22_les_v%22:%22y%2Crealtor.com%2C1592399063%22}; QSI_HistorySession=https%3A%2F%2Fwww.realtor.com%2F~1592121714314%7Chttps%3A%2F%2Fwww.realtor.com%2Frealestateandhomes-search%2FLos-Angeles_CA~1592121858842%7Chttps%3A%2F%2Fwww.realtor.com%2F~1592382357897%7Chttps%3A%2F%2Fwww.realtor.com%2Frealestateandhomes-search%2FLos-Angeles_CA%2Fpg-1~1592382396018%7Chttps%3A%2F%2Fwww.realtor.com%2F~1592389011319%7Chttps%3A%2F%2Fwww.realtor.com%2Frealestateandhomes-search%2FLos-Angeles_CA~1592389049666%7Chttps%3A%2F%2Fwww.realtor.com%2Frealestateandhomes-search%2FLos-Angeles_CA%2Fpg-1~1592389066514%7Chttps%3A%2F%2Fwww.realtor.com%2Frealestateandhomes-search%2FLos-Angeles_CA%3Fpg-1~1592389983552%7Chttps%3A%2F%2Fwww.realtor.com%2Frealestateandhomes-search%2FLos-Angeles_CA~1592390004282%7Chttps%3A%2F%2Fwww.realtor.com%2Frealestateandhomes-search%2FLos-Angeles_CA%2Fpg-1~1592390021218%7Chttps%3A%2F%2Fwww.realtor.com%2F~1592397217753%7Chttps%3A%2F%2Fwww.realtor.com%2Frealestateandhomes-search%2FLos-Angeles_CA%2Fpg-1~1592397264396; _ncg_sp_id.cc72=680c2ec8-4253-4530-b01b-97f8f0918165.1592121715.1.1592397265.1592121715.372769d8-fb8f-4d89-bbb1-36d8a4ee9885; _gat=1; _uetsid=a86fb78c-37e3-7550-8273-44a9a1d6b5b7; _uetvid=553b4b61-7176-0246-a957-9b5735ff6fa5', 'user-agent': 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36'})), [csv.DictWriter(open('realtor.csv', 'a'), ['title', 'address', 'price', 'bedrooms', 'bathrooms', 'area', 'area_lot']).writerow({'title': card.css('div[data-label="pc-type"]').css('span[class="jsx-527056098"]::text').get(), 'address': ''.join(card.css('div[data-label="pc-address"] *::text').getall()), 'price': card.css('span[data-label="pc-price"]::text').get(), 'bedrooms': ' '.join(card.css('li[data-label="pc-meta-beds"] *::text').getall()), 'bathrooms': ' '.join(card.css('li[data-label="pc-meta-baths"] *::text').getall()), 'area': ' '.join(card.css('li[data-label="pc-meta-sqft"] *::text').getall()), 'area_lot': ' '.join(card.css('li[data-label="pc-meta-sqftlot"] *::text').getall())}) for card in response.css('li[class="jsx-2423110403 component_property-card"]').css('div[data-label="property-card"]')]) for page in range(1, 6)]
